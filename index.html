<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Charles Git Barber Receipt — Access Protected</title>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto+Mono&display=swap');

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0; padding: 0;
    background: linear-gradient(135deg, #6b5b95, #9a8c98);
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #2e2e3e;
    transition: background 0.5s ease;
  }

  /* Access Screen */
  #accessScreen {
    background: #f3e6ff;
    border-radius: 20px;
    padding: 45px 35px 35px 35px;
    box-shadow: 0 14px 40px rgba(107, 91, 149, 0.6);
    max-width: 400px;
    width: 90vw;
    text-align: center;
    position: relative;
  }

  #accessScreen h1 {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 2.7rem;
    margin-bottom: 22px;
    color: #3f2c56;
    letter-spacing: 2px;
    user-select: none;
    animation: fadeInSlideDown 1s ease forwards;
  }

  @keyframes fadeInSlideDown {
    0% {opacity: 0; transform: translateY(-30px);}
    100% {opacity: 1; transform: translateY(0);}
  }

  .password-wrapper {
    position: relative;
    margin-top: 32px;
  }

  #password {
    width: 100%;
    padding: 16px 50px 16px 18px;
    font-size: 1.25rem;
    border-radius: 12px;
    border: 2px solid #a093c7;
    outline-color: #9b84b7;
    font-family: 'Roboto Mono', monospace;
    transition: border-color 0.3s;
    background: #f8f2ff;
    color: #3f2c56;
  }
  #password:focus {
    border-color: #6b5b95;
    background: #e9dcff;
  }

  .toggle-eye {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 1.5rem;
    user-select: none;
    color: #6b5b95;
    transition: color 0.3s;
  }
  .toggle-eye:hover {
    color: #9a8c98;
  }

  #accessBtn {
    margin-top: 34px;
    background: #5a478b;
    border: none;
    color: white;
    padding: 16px 0;
    width: 100%;
    border-radius: 14px;
    font-size: 1.3rem;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    transition: background 0.3s, box-shadow 0.3s;
    box-shadow: 0 6px 14px rgba(90, 71, 139, 0.6);
  }
  #accessBtn:hover {
    background: #3f2c56;
    box-shadow: 0 8px 18px rgba(63, 44, 86, 0.8);
  }

  #errorMsg {
    color: #d94f4f;
    margin-top: 18px;
    font-weight: 700;
    height: 26px;
    font-family: 'Roboto Mono', monospace;
  }

  /* Receipt container */
  #receiptContainer {
    display: none;
    background: #fefefe;
    max-width: 780px;
    width: 95vw;
    border-radius: 20px;
    box-shadow: 0 14px 40px rgba(107, 91, 149, 0.35);
    padding: 35px 45px;
    font-family: 'Roboto Mono', monospace;
    color: #2e2e3e;
    transition: box-shadow 0.3s ease;
  }
  #receiptContainer:focus-within {
    box-shadow: 0 14px 40px rgba(74, 71, 163, 0.55);
    outline: none;
  }

  #receiptHeader {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    border-bottom: 3px solid #bfa2db;
    padding-bottom: 15px;
    margin-bottom: 22px;
    gap: 10px;
  }

  #shopName {
    font-family: 'Poppins', sans-serif;
    font-weight: 700;
    color: #5a478b;
    font-size: 2.4rem;
    margin: 0;
    user-select: text;
    border-bottom: 2px dashed transparent;
    padding-bottom: 3px;
    cursor: text;
    transition: border-color 0.3s;
  }
  #shopName:focus {
    outline: none;
    border-bottom: 2px dashed #7e7cc2;
  }

  #shopAddress,
  #shopContact {
    font-size: 1rem;
    color: #6e649f;
    user-select: text;
    border-bottom: 2px dashed transparent;
    padding-bottom: 3px;
    cursor: text;
    transition: border-color 0.3s;
    line-height: 1.3;
    margin: 0;
  }
  #shopAddress:focus,
  #shopContact:focus {
    outline: none;
    border-bottom: 2px dashed #7e7cc2;
  }
  /* reduce spacing between address and phone */
  #shopAddress {
    margin-bottom: 4px;
  }

  /* Receipt Meta (Receipt #, Date, Cashier) */
  #receiptMeta {
    display: flex;
    flex-wrap: wrap;
    gap: 18px;
    margin-bottom: 26px;
    font-size: 1.1rem;
  }
  #receiptMeta label {
    font-weight: 600;
    color: #5a478b;
    user-select: none;
    min-width: 130px;
  }
  #receiptMeta input {
    padding: 8px 14px;
    border-radius: 12px;
    border: 2px solid #bfa2db;
    font-family: 'Roboto Mono', monospace;
    font-size: 1.1rem;
    width: 160px;
    transition: border-color 0.3s;
    color: #3f2c56;
  }
  #receiptMeta input:focus {
    border-color: #7e7cc2;
    outline: none;
    background: #eae5f6;
  }

  /* Client info */
  #clientInfo {
    display: flex;
    flex-wrap: nowrap;
    gap: 12px;
    margin-bottom: 26px;
  }
  #clientInfo input {
    padding: 12px 16px;
    font-size: 1.1rem;
    border-radius: 14px;
    border: 2px solid #bfa2db;
    transition: border-color 0.3s, background 0.3s;
    color: #3f2c56;
    background: #f9f7ff;
  }
  #clientInfo input:focus {
    border-color: #7e7cc2;
    background: #eae5f6;
    outline: none;
  }

  /* Table styling */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 26px;
    font-size: 1.1rem;
  }
  table th, table td {
    border-bottom: 2px solid #bfa2db;
    padding: 14px 10px;
    text-align: left;
    vertical-align: middle;
  }
  table th {
    background: #7e7cc2;
    color: white;
    font-weight: 600;
    user-select: none;
  }

  table td input[type="text"],
  table td input[type="number"] {
    width: 100%;
    padding: 8px 14px;
    border-radius: 12px;
    border: 2px solid #bfa2db;
    font-family: 'Roboto Mono', monospace;
    font-size: 1.1rem;
    box-sizing: border-box;
    transition: border-color 0.3s, background 0.3s;
    color: #3f2c56;
    background: #f9f7ff;
  }
  table td input[type="text"]:focus,
  table td input[type="number"]:focus {
    border-color: #7e7cc2;
    background: #eae5f6;
    outline: none;
  }

  .remove-row-btn {
    background: transparent;
    border: none;
    color: #c04e4e;
    font-size: 1.6rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s;
  }
  .remove-row-btn:hover {
    color: #852e2e;
  }

  /* Add service button */
  #addServiceBtn {
    background: #5a478b;
    color: white;
    padding: 16px 24px;
    border: none;
    border-radius: 16px;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    font-size: 1.3rem;
    cursor: pointer;
    transition: background 0.3s, box-shadow 0.3s;
    margin-bottom: 28px;
    box-shadow: 0 5px 15px rgba(90, 71, 139, 0.5);
  }
  #addServiceBtn:hover {
    background: #3f2c56;
    box-shadow: 0 6px 18px rgba(63, 44, 86, 0.7);
  }

  /* Total Section */
  #totalSection {
    text-align: right;
    font-size: 1.75rem;
    font-weight: 700;
    color: #5a478b;
    margin-bottom: 16px;
    user-select: none;
    text-shadow: 0 1px 1px rgba(233, 229, 246, 0.6);
  }

  /* Print and PDF Buttons */
  #actions {
    display: flex;
    justify-content: flex-end;
    gap: 18px;
  }

  #actions button {
    padding: 12px 28px;
    font-size: 1.15rem;
    border: none;
    cursor: pointer;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
    border-radius: 16px;
    background: #5a478b;
    color: white;
    box-shadow: 0 5px 15px rgba(90, 71, 139, 0.6);
    transition: background 0.3s, box-shadow 0.3s;
  }
  #actions button:hover {
    background: #3f2c56;
    box-shadow: 0 7px 20px rgba(63, 44, 86, 0.8);
  }

  /* Responsive improvements for small screens */
  @media (max-width: 560px) {
    #receiptContainer {
      padding: 28px 22px;
    }

    #receiptHeader {
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      padding-bottom: 12px;
      margin-bottom: 18px;
    }

    #shopName {
      font-size: 2.1rem;
    }
    #shopAddress, #shopContact {
      font-size: 0.95rem;
      margin-bottom: 2px;
    }

    #receiptMeta {
      flex-direction: column;
      gap: 12px;
    }
    #receiptMeta label {
      min-width: auto;
    }
    #receiptMeta input {
      width: 100%;
      max-width: 100%;
    }

    /* Fix client info: wrap and reduce input size */
    #clientInfo {
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
    }
    #clientInfo input {
      flex: 1 1 45%;
      font-size: 1rem;
      padding: 10px 14px;
      border-radius: 12px;
      min-width: 0;
      box-sizing: border-box;
    }

    /* Services table - stack with titles */
    table, thead, tbody, th, td, tr {
      display: block;
      width: 100%;
    }
    thead tr {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }
    tr {
      margin-bottom: 20px;
      border-bottom: 1px solid #bfa2db;
      padding-bottom: 14px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    td {
      border: none;
      padding: 0 !important;
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #4b4175;
    }
    td:last-child {
      text-align: right;
    }

    /* Add labels above inputs */
    td.service-name::before {
      content: "Service";
      display: block;
      font-weight: 700;
      margin-bottom: 4px;
      color: #5a478b;
    }
    td.service-qty::before {
      content: "Quantity";
      display: block;
      font-weight: 700;
      margin-bottom: 4px;
      color: #5a478b;
    }
    td.service-price::before {
      content: "Price (KSh)";
      display: block;
      font-weight: 700;
      margin-bottom: 4px;
      color: #5a478b;
    }
    td.remove-btn::before {
      content: "Remove";
      display: block;
      font-weight: 700;
      margin-bottom: 4px;
      color: #c04e4e;
      text-align: right;
    }

    td input[type="text"],
    td input[type="number"] {
      width: 100%;
      padding: 10px 14px;
      font-weight: 400;
      color: #3f2c56;
      font-family: 'Roboto Mono', monospace;
      font-size: 1rem;
      background: #f5f1ff;
      border-radius: 12px;
      border: 2px solid #bfa2db;
      transition: border-color 0.3s, background 0.3s;
    }
    td input[type="text"]:focus,
    td input[type="number"]:focus {
      border-color: #7e7cc2;
      background: #e2dbff;
      outline: none;
      font-weight: 600;
    }

    /* Remove button styling */
    .remove-row-btn {
      font-size: 1.8rem;
      color: #c04e4e;
      background: #fdeeee;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      padding: 4px 10px;
      user-select: none;
    }
    .remove-row-btn:hover {
      background: #fcd5d5;
      color: #7a2727;
    }

    #addServiceBtn {
      font-size: 1.4rem;
      padding: 18px 26px;
      width: 100%;
      box-shadow: 0 6px 18px rgba(90, 71, 139, 0.55);
      border-radius: 16px;
    }

    #totalSection {
      font-size: 2.1rem;
      margin-top: 18px;
      text-align: right;
      font-weight: 700;
      color: #5a478b;
      text-shadow: 0 1px 2px rgba(156, 138, 156, 0.6);
      user-select: none;
    }

    #actions {
      flex-direction: column;
      gap: 14px;
      justify-content: center;
    }
    #actions button {
      width: 100%;
      border-radius: 16px;
    }
  }

  /* Placeholder vanish on focus */
  input:focus::placeholder {
    color: transparent;
  }

</style>
</head>
<body>

<!-- ACCESS PASSWORD -->
<div id="accessScreen" role="dialog" aria-modal="true" aria-labelledby="accessTitle">
  <h1 id="accessTitle">Enter Access Code</h1>
  <div class="password-wrapper">
    <input
      type="password"
      id="password"
      aria-label="Access Password"
      placeholder="Enter Password"
      autocomplete="off"
      spellcheck="false"
    />
    <span class="toggle-eye" id="togglePassword" role="button" aria-label="Toggle password visibility" tabindex="0">👁️</span>
  </div>
  <button id="accessBtn" aria-describedby="errorMsg">Submit</button>
  <div id="errorMsg" role="alert" aria-live="assertive"></div>
</div>

<!-- RECEIPT -->
<div id="receiptContainer" role="main" tabindex="-1" aria-label="Receipt details">
  <header id="receiptHeader">
    <h2 id="shopName" contenteditable="true" aria-label="Shop Name" spellcheck="false">Charles Git Barber</h2>
    <!--p id="shopAddress" contenteditable="true" aria-label="Shop Address" spellcheck="false">123 Lilac Street, Nairobi</p-->
    <p id="shopContact" contenteditable="true" aria-label="Shop Phone Number" spellcheck="false">Phone: +1 314 365 7077| Email: royalpettyerrandsrv@gmail.com</p>
  </header>

  <section id="receiptMeta" aria-label="Receipt Information">
    <label for="receiptNumber">Receipt No.</label>
    <input type="text" id="receiptNumber" value="000001" aria-required="true" />

    <label for="receiptDate">Date</label>
    <input type="date" id="receiptDate" aria-required="true" />

    <label for="cashierName">Cashier</label>
    <input type="text" id="cashierName" placeholder="Cashier Name" aria-required="true" />
  </section>

  <section id="clientInfo" aria-label="Client Information">
    <input
      type="text"
      id="clientName"
      placeholder="Client Name"
      autocomplete="off"
      aria-required="true"
      spellcheck="false"
    />
    <input
      type="email"
      id="clientEmail"
      placeholder="Client Email"
      autocomplete="off"
      aria-required="true"
      spellcheck="false"
      pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$"
      title="Please enter a valid email address"
    />
    <input
      type="tel"
      id="clientPhone"
      placeholder="Client Phone"
      autocomplete="off"
      aria-required="true"
      spellcheck="false"
      pattern="^\+?[0-9\s\-]{7,15}$"
      title="Please enter a valid phone number"
    />
  </section>

  <table aria-label="Services rendered">
    <thead>
      <tr>
        <th scope="col">Service</th>
        <th scope="col">Quantity</th>
        <th scope="col">Price ($)</th>
        <th scope="col">Remove</th>
      </tr>
    </thead>
    <tbody id="servicesBody">
      <tr>
        <td class="service-name"><input type="text" placeholder="Service description" aria-label="Service description" /></td>
        <td class="service-qty"><input type="number" min="1" value="1" aria-label="Quantity" /></td>
        <td class="service-price"><input type="number" min="0" step="0.01" value="0.00" aria-label="Price" /></td>
        <td class="remove-btn"><button class="remove-row-btn" aria-label="Remove service row">&times;</button></td>
      </tr>
    </tbody>
  </table>

  <button id="addServiceBtn" aria-label="Add service row">+ Add Service</button>

  <div id="totalSection" aria-live="polite" aria-atomic="true">Total: $ 0.00</div>

  <div id="actions">
    <button id="printBtn" aria-label="Print Receipt">Print Receipt</button>
    <button id="downloadPdfBtn" aria-label="Download Receipt as PDF">Download PDF</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  (function(){
    const ACCESS_PASSWORD = "charles123"; // Hardcoded password

    const accessScreen = document.getElementById('accessScreen');
    const receiptContainer = document.getElementById('receiptContainer');
    const passwordInput = document.getElementById('password');
    const accessBtn = document.getElementById('accessBtn');
    const errorMsg = document.getElementById('errorMsg');
    const togglePassword = document.getElementById('togglePassword');

    // Toggle password visibility
    togglePassword.addEventListener('click', () => {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      togglePassword.textContent = type === 'password' ? '👁️' : '🙈';
      passwordInput.focus();
    });
    togglePassword.addEventListener('keydown', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        togglePassword.click();
      }
    });

    // Submit password
    accessBtn.addEventListener('click', () => {
      const val = passwordInput.value.trim();
      if(val === ACCESS_PASSWORD){
        errorMsg.textContent = "";
        accessScreen.style.display = "none";
        receiptContainer.style.display = "block";
        receiptContainer.focus();
      } else {
        errorMsg.textContent = "Wrong password, please try again.";
        passwordInput.value = "";
        passwordInput.focus();
      }
    });

    passwordInput.addEventListener("keydown", e => {
      if(e.key === "Enter"){
        accessBtn.click();
      }
    });

    // Services Table Logic
    const servicesBody = document.getElementById('servicesBody');
    const addServiceBtn = document.getElementById('addServiceBtn');
    const totalSection = document.getElementById('totalSection');

    function updateTotal() {
      let total = 0;
      servicesBody.querySelectorAll('tr').forEach(row => {
        const qtyInput = row.querySelector('.service-qty input');
        const priceInput = row.querySelector('.service-price input');

        let qty = parseFloat(qtyInput.value);
        let price = parseFloat(priceInput.value);

        if(isNaN(qty) || qty < 0) qty = 0;
        if(isNaN(price) || price < 0) price = 0;

        total += qty * price;
      });
      totalSection.textContent = `Total: KSh ${total.toFixed(2)}`;
    }

    // Add row
    addServiceBtn.addEventListener('click', () => {
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td class="service-name"><input type="text" placeholder="Service description" aria-label="Service description" /></td>
        <td class="service-qty"><input type="number" min="1" value="1" aria-label="Quantity" /></td>
        <td class="service-price"><input type="number" min="0" step="0.01" value="0.00" aria-label="Price" /></td>
        <td class="remove-btn"><button class="remove-row-btn" aria-label="Remove service row">&times;</button></td>
      `;
      servicesBody.appendChild(newRow);
      addListenersToRow(newRow);
      updateTotal();
    });

    function addListenersToRow(row){
      const qtyInput = row.querySelector('.service-qty input');
      const priceInput = row.querySelector('.service-price input');
      const removeBtn = row.querySelector('.remove-row-btn');

      qtyInput.addEventListener('input', updateTotal);
      priceInput.addEventListener('input', updateTotal);

      removeBtn.addEventListener('click', () => {
        if(servicesBody.rows.length > 1){
          row.remove();
          updateTotal();
        }
      });
    }

    // Add listeners to initial row
    servicesBody.querySelectorAll('tr').forEach(row => addListenersToRow(row));
    updateTotal();

    // PRINT FUNCTIONALITY
    document.getElementById('printBtn').addEventListener('click', () => {
      window.print();
    });

    // PDF Download functionality using jsPDF
    document.getElementById('downloadPdfBtn').addEventListener('click', () => {
      import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js').then(({ jsPDF }) => {
        const doc = new jsPDF.jsPDF({
          unit: 'pt',
          format: 'a4',
        });

        const leftMargin = 40;
        let y = 40;
        const lineHeight = 18;
        const pageWidth = doc.internal.pageSize.getWidth();

        function addText(text, fontSize = 12, fontStyle = 'normal', align='left', offsetX=leftMargin) {
          doc.setFontSize(fontSize);
          doc.setFont(undefined, fontStyle);
          let x = offsetX;
          if(align === 'center'){
            const textWidth = doc.getTextWidth(text);
            x = (pageWidth - textWidth)/2;
          }
          doc.text(text, x, y);
          y += lineHeight;
        }

        // Header
        const shopName = document.getElementById('shopName').textContent.trim();
        const shopAddress = document.getElementById('shopAddress').textContent.trim();
        const shopContact = document.getElementById('shopContact').textContent.trim();

        addText(shopName, 22, 'bold', 'center');
        addText(shopAddress, 12, 'normal', 'center');
        addText(shopContact, 12, 'normal', 'center');

        y += 10;

        // Receipt meta
        const receiptNumber = document.getElementById('receiptNumber').value.trim();
        const receiptDate = document.getElementById('receiptDate').value;
        const cashierName = document.getElementById('cashierName').value.trim();

        addText(`Receipt No: ${receiptNumber}`, 12, 'bold');
        addText(`Date: ${receiptDate}`, 12, 'bold');
        addText(`Cashier: ${cashierName}`, 12, 'bold');

        y += 10;

        // Client info
        const clientName = document.getElementById('clientName').value.trim();
        const clientEmail = document.getElementById('clientEmail').value.trim();
        const clientPhone = document.getElementById('clientPhone').value.trim();

        addText(`Client Name: ${clientName}`, 12);
        addText(`Client Email: ${clientEmail}`, 12);
        addText(`Client Phone: ${clientPhone}`, 12);

        y += 15;

        // Services Table Header
        doc.setDrawColor(110);
        doc.setFillColor(74, 71, 163);
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.rect(leftMargin - 5, y - lineHeight + 2, pageWidth - 2*leftMargin + 10, lineHeight, 'F');
        doc.text('Service', leftMargin, y);
        doc.text('Qty', pageWidth - leftMargin - 100, y);
        doc.text('Price', pageWidth - leftMargin - 50, y);
        doc.setTextColor(0, 0, 0);
        y += lineHeight;

        // Services rows
        const rows = [];
        const serviceRows = document.querySelectorAll('#servicesBody tr');
        serviceRows.forEach(row => {
          const service = row.querySelector('.service-name input').value.trim();
          const qty = row.querySelector('.service-qty input').value;
          const price = parseFloat(row.querySelector('.service-price input').value).toFixed(2);
          if(service){
            rows.push({service, qty, price});
          }
        });

        doc.setFontSize(12);
        doc.setFont(undefined, 'normal');
        rows.forEach(row => {
          if(y > doc.internal.pageSize.getHeight() - 40){
            doc.addPage();
            y = 40;
          }
          doc.text(row.service, leftMargin, y);
          doc.text(String(row.qty), pageWidth - leftMargin - 100, y, {align: 'right'});
          doc.text(`KSh ${row.price}`, pageWidth - leftMargin - 50, y, {align: 'right'});
          y += lineHeight;
        });

        y += 10;
        // Total
        const totalText = totalSection.textContent;
        doc.setFont(undefined, 'bold');
        doc.setFontSize(16);
        doc.text(totalText, pageWidth - leftMargin, y, {align: 'right'});

        doc.save(`Receipt_${receiptNumber || '0000'}.pdf`);
      });
    });
  })();
</script>

</body>
</html>
